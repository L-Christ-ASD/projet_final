apiVersion: traefik.io/v1alpha1
kind: IngressRoute
metadata:
  name: traefik-dashboard
  namespace: {{ .Values.namespace }}

spec:
  entryPoints:
    - websecure  # Définit l'entrypoint sécurisé (HTTPS)
    
  routes:
    - match: Host(`traefik.{{ .Values.domain }}`) && PathPrefix(`/dashboard`) # Le domaine et le chemin pour accéder au tableau de bord
      kind: Rule
      services:
        - name: traefik
          port: 8080 # Le port du service Traefik
      middlewares:
        - name: dashboard-auth
          namespace: {{ .Values.namespace }}  # Le middleware d'authentification
        - name: default-redirectscheme
          namespace: {{ .Values.namespace }} # Si tu veux rediriger les requêtes HTTP vers HTTPS
  tls:
    certResolver: myresolver # Utiliser le certResolver pour générer un certificat SSL (Let's Encrypt)










#apiVersion: networking.k8s.io/v1
#kind: Ingress
#metadata:
#  name: traefik-dashboard
#  namespace: {{ .Values.namespace }}
#  annotations:
#    traefik.ingress.kubernetes.io/router.entrypoints: websecure
#    traefik.ingress.kubernetes.io/router.middlewares: "{{ .Values.namespace }}-dashboard-auth@kubernetescrd,{{ .Values.namespace }}-redirectscheme@kubernetescrd"
#    traefik.ingress.kubernetes.io/router.tls: "true"
#    traefik.ingress.kubernetes.io/router.tls.certresolver: myresolver
#spec:
#  rules:
#    - host: traefik.{{ .Values.domain }}
#      http:
#        paths:
#          - path: /dashboard
#            pathType: Prefix
#            backend:
#              service:
#                name: traefik
#                port:
#                  number: 8080
#  tls:
#    - hosts:
#        - traefik.{{ .Values.domain }}
#